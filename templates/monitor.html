<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamBet AI Detection Monitor</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #f59e0b;
            font-size: 2em;
        }
        
        .status {
            text-align: center;
            margin-bottom: 30px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .status.connected {
            background: #10b981;
            color: white;
        }
        
        .status.disconnected {
            background: #ef4444;
            color: white;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .panel-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #f59e0b;
            border-bottom: 2px solid #334155;
            padding-bottom: 10px;
        }
        
        .detection-item {
            background: #334155;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #f59e0b;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .detection-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .label {
            font-weight: 600;
            color: #fbbf24;
            font-size: 1.1em;
        }
        
        .confidence {
            background: #10b981;
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .confidence.low {
            background: #ef4444;
        }
        
        .confidence.medium {
            background: #f59e0b;
        }
        
        .meta {
            font-size: 0.9em;
            color: #94a3b8;
            margin-top: 5px;
        }
        
        .timestamp {
            color: #60a5fa;
            font-weight: 600;
        }
        
        .video-id {
            color: #a78bfa;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-card {
            background: #334155;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #f59e0b;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #94a3b8;
            margin-top: 5px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #f59e0b;
            color: white;
        }
        
        .btn-primary:hover {
            background: #d97706;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #334155;
            color: #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ StreamBet AI Detection Monitor</h1>
        <div id="status" class="status disconnected">
            üî¥ Disconnected from backend
        </div>
        
        <div class="controls">
            <button class="btn-primary" onclick="testAnalysis()">
                üé¨ Test Video Analysis
            </button>
            <button class="btn-secondary" onclick="clearDetections()">
                üóëÔ∏è Clear Detections
            </button>
        </div>
        
        <div class="grid">
            <div class="panel">
                <div class="panel-title">üö® Real-Time Detections</div>
                <div id="detections">
                    <div class="empty-state">
                        Waiting for detections...
                        <br><br>
                        Click "Test Video Analysis" to start
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">üìä Statistics</div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-count">0</div>
                        <div class="stat-label">Total Detections</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-confidence">0%</div>
                        <div class="stat-label">Avg Confidence</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="unique-labels">0</div>
                        <div class="stat-label">Unique Labels</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="videos-analyzed">0</div>
                        <div class="stat-label">Videos Analyzed</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Connect to backend Socket.IO
        const socket = io('http://localhost:8000');
        const statusEl = document.getElementById('status');
        const detectionsEl = document.getElementById('detections');
        
        let detections = [];
        let uniqueLabels = new Set();
        let uniqueVideos = new Set();
        
        // Connection status
        socket.on('connect', () => {
            console.log('‚úÖ Connected to backend');
            statusEl.className = 'status connected';
            statusEl.innerHTML = '‚úÖ Connected to backend';
        });
        
        socket.on('disconnect', () => {
            console.log('‚ùå Disconnected from backend');
            statusEl.className = 'status disconnected';
            statusEl.innerHTML = 'üî¥ Disconnected from backend';
        });
        
        // Listen for AI detections
        socket.on('ai_detection', (event) => {
            console.log('üö® Detection received:', event.data);
            addDetection(event.data);
        });
        
        function addDetection(detection) {
            detections.unshift(detection);
            uniqueLabels.add(detection.label);
            uniqueVideos.add(detection.video_id);
            
            // Update UI
            renderDetections();
            updateStats();
            
            // Play sound or show notification
            playNotificationSound();
        }
        
        function renderDetections() {
            if (detections.length === 0) {
                detectionsEl.innerHTML = `
                    <div class="empty-state">
                        Waiting for detections...
                    </div>
                `;
                return;
            }
            
            detectionsEl.innerHTML = detections.slice(0, 20).map(d => {
                const confidenceClass = d.confidence >= 0.8 ? '' : 
                                       d.confidence >= 0.6 ? 'medium' : 'low';
                const timestamp = new Date(d.ts * 1000).toLocaleTimeString();
                
                return `
                    <div class="detection-item">
                        <div class="detection-header">
                            <span class="label">üéØ ${d.label.toUpperCase()}</span>
                            <span class="confidence ${confidenceClass}">
                                ${(d.confidence * 100).toFixed(1)}%
                            </span>
                        </div>
                        <div class="meta">
                            <span class="video-id">üìπ ${d.video_id}</span> ‚Ä¢ 
                            <span class="timestamp">‚è±Ô∏è ${d.timestamp.toFixed(2)}s</span> ‚Ä¢ 
                            <span>üïê ${timestamp}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateStats() {
            document.getElementById('total-count').textContent = detections.length;
            document.getElementById('unique-labels').textContent = uniqueLabels.size;
            document.getElementById('videos-analyzed').textContent = uniqueVideos.size;
            
            const avgConfidence = detections.reduce((sum, d) => sum + d.confidence, 0) / detections.length;
            document.getElementById('avg-confidence').textContent = 
                (avgConfidence * 100).toFixed(1) + '%';
        }
        
        function clearDetections() {
            if (confirm('Clear all detections?')) {
                detections = [];
                uniqueLabels.clear();
                uniqueVideos.clear();
                renderDetections();
                updateStats();
            }
        }
        
        async function testAnalysis() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ Analyzing...';
            
            try {
                const response = await fetch('http://localhost:8080/invocations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        video_url: 'http://localhost:5000/uploads/1760892120_tets.mp4',
                        video_id: `test_${Date.now()}`,
                        labels: ['person', 'fighting', 'sport', 'fun'],
                        confidence: 0.6,
                        fps_sample: 1
                    })
                });
                
                const result = await response.json();
                console.log('Analysis complete:', result);
                
                button.textContent = '‚úÖ Analysis Complete!';
                setTimeout(() => {
                    button.disabled = false;
                    button.textContent = 'üé¨ Test Video Analysis';
                }, 2000);
                
            } catch (error) {
                console.error('Analysis failed:', error);
                button.textContent = '‚ùå Analysis Failed';
                button.disabled = false;
            }
        }
        
        function playNotificationSound() {
            // Optional: Add sound effect
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBDJ+zPDTjzgJFmS47OehUhELTKXh8LJnHgU2jdXx');
                audio.volume = 0.3;
                audio.play();
            } catch (e) {
                // Ignore if audio fails
            }
        }
        
        // Initial render
        renderDetections();
        updateStats();
    </script>
</body>
</html>
